# 機能一覧書 - 薄毛対策AIエージェント

**プロジェクト**: hackathon-google (Google Cloud Japan AI Hackathon Vol.4)
**最終更新**: 2026-01-29
**バージョン**: 1.1

---

## 1. 概要

### 1.1 本書の目的

本書は、薄毛対策AIエージェントシステムの**全機能**を体系的にIDを振って整理した機能一覧書である。
モック作成・実装フェーズで参照しやすい形式にまとめている。

### 1.2 対象機能サマリー

| カテゴリ | 機能数 | 画面数 | ADKツール数 |
|---------|--------|--------|-------------|
| 共通機能（FNC-00） | 8 | 4 | - |
| 機能1: 生え際・髪密度 AIチェック（FNC-01） | 16 | 4 | 4 |
| 機能2: 髪のお悩み相談チャットボット（FNC-02） | 9 | 3 | 3 |
| 機能3: 育毛サポート生活アドバイザー（FNC-03） | 13 | 5 | 6 |
| **合計** | **46** | **16** | **13** |

### 1.3 ID体系

#### 機能ID（FNC）

| 接頭辞 | 対象 | 例 |
|--------|------|-----|
| FNC-00-XXX | 共通機能 | FNC-00-001: Googleログイン |
| FNC-01-XXX | 機能1: 生え際・髪密度 AIチェック | FNC-01-001: 撮影ガイド表示 |
| FNC-02-XXX | 機能2: 髪のお悩み相談チャットボット | FNC-02-001: チャット送信 |
| FNC-03-XXX | 機能3: 育毛サポート生活アドバイザー | FNC-03-001: 解析結果取得 |

#### 画面ID（SCR）

| 接頭辞 | 対象 |
|--------|------|
| SCR-00-XX | 共通画面 |
| SCR-01-XX | 機能1画面 |
| SCR-02-XX | 機能2画面 |
| SCR-03-XX | 機能3画面 |

#### ツールID（TL）

| 接頭辞 | 対象エージェント |
|--------|-----------------|
| TL-01-XXX | haircheck_agent（機能1） |
| TL-02-XXX | consultation_agent（機能2） |
| TL-03-XXX | lifestyle_agent（機能3） |

---

## 2. 機能一覧（全機能）

### 2.1 共通機能（FNC-00）

| 機能ID | 機能名 | 対象画面 | 概要 | 優先度 |
|--------|--------|---------|------|--------|
| FNC-00-001 | Googleログイン | SCR-00-01 | Firebase AuthでGoogleアカウント認証 | 必須 |
| FNC-00-002 | ログアウト | SCR-00-04 | ログアウト処理 | 必須 |
| FNC-00-003 | プロフィール登録 | SCR-00-02 | 性別、年齢、悩みを初回登録 | 必須 |
| FNC-00-004 | プロフィール編集 | SCR-00-02 | プロフィール情報を編集 | 任意 |
| FNC-00-005 | ホーム画面表示 | SCR-00-03 | 3機能への導線、最新情報サマリー表示 | 必須 |
| FNC-00-006 | 機能選択 | SCR-00-03 | 3つの機能画面へ遷移 | 必須 |
| FNC-00-007 | 通知設定 | SCR-00-04 | 通知ON/OFF設定 | 任意 |
| FNC-00-008 | プライバシー設定 | SCR-00-04 | データ削除等 | 任意 |

### 2.2 機能1: 生え際・髪密度 AIチェック（FNC-01）

| 機能ID | 機能名 | 対象画面 | 概要 | ADKツール | 優先度 |
|--------|--------|---------|------|----------|--------|
| FNC-01-001 | 撮影ガイド表示 | SCR-01-01 | 撮影位置・角度をAIがガイド | - | 必須 |
| FNC-01-002 | 頭部画像撮影 | SCR-01-01 | カメラで頭部写真を撮影 | - | 必須 |
| FNC-01-003 | 頭部画像選択 | SCR-01-01 | ギャラリーから画像を選択 | - | 必須 |
| FNC-01-004 | AI画像解析 | SCR-01-02 | Gemini Visionで頭部画像を解析 | TL-01-001 | 必須 |
| FNC-01-005 | 髪密度算出 | SCR-01-02 | 髪密度スコア(0-100)を算出 | TL-01-001 | 必須 |
| FNC-01-005a | 細毛率算出 | SCR-01-02 | 細い毛髪の割合(0-1.0)を算出 | TL-01-001 | 必須 |
| FNC-01-006 | 頭皮状態判定 | SCR-01-02 | 頭皮の状態を判定 | TL-01-001 | 必須 |
| FNC-01-007 | 薄毛タイプ判定（男性） | SCR-01-02 | ハミルトン・ノーウッド分類で判定 | TL-01-001 | 必須 |
| FNC-01-008 | 薄毛タイプ判定（女性） | SCR-01-02 | ルードヴィッヒ分類で判定 | TL-01-001 | 必須 |
| FNC-01-009 | 脱毛パターン判定 | SCR-01-02 | M字/O字/U字等のパターン判定 | TL-01-001 | 必須 |
| FNC-01-010 | 前回比較 | SCR-01-02 | 過去データと比較し変化を検出 | TL-01-002 | 必須 |
| FNC-01-011 | 時系列データ表示 | SCR-01-03 | ダッシュボードで推移を表示 | TL-01-004 | 必須 |
| FNC-01-012 | 推移グラフ表示 | SCR-01-03 | 髪密度等のグラフを表示 | TL-01-004 | 必須 |
| FNC-01-013 | 自然言語レポート生成 | SCR-01-04 | AIがレポートを自然言語で生成 | TL-01-003 | 必須 |
| FNC-01-014 | レポート詳細表示 | SCR-01-04 | 生成されたレポートを表示 | - | 必須 |
| FNC-01-015 | 過去写真一覧表示 | SCR-01-03 | 過去の写真を一覧表示 | TL-01-004 | 任意 |

### 2.3 機能2: 髪のお悩み相談チャットボット（FNC-02）

| 機能ID | 機能名 | 対象画面 | 概要 | ADKツール | 優先度 |
|--------|--------|---------|------|----------|--------|
| FNC-02-001 | チャット送信 | SCR-02-01 | ユーザーがメッセージを送信 | - | 必須 |
| FNC-02-002 | AI応答生成 | SCR-02-01 | AIがメッセージに応答 | - | 必須 |
| FNC-02-003 | ユーザーニーズ分析 | SCR-02-01 | ユーザーの求めている対応を分析 | TL-02-001 | 必須 |
| FNC-02-004 | 応答スタイル適応 | SCR-02-01 | ニーズタイプに応じた応答スタイルを選択 | - | 必須 |
| FNC-02-005 | チーム会議発動（手動） | SCR-02-01 | ユーザーリクエストで発動 | TL-02-003 | 必須 |
| FNC-02-006 | チーム会議発動（自動） | SCR-02-01 | 深刻な悩み検出時・重要判断場面で自動発動 | TL-02-003 | 任意 |
| FNC-02-007 | チーム会議表示 | SCR-02-02 | 3視点の議論を表示 | - | 必須 |
| FNC-02-008 | 会話履歴取得 | SCR-02-01 | 過去の会話履歴を取得 | TL-02-002 | 必須 |
| FNC-02-009 | 対応スタイル設定 | SCR-02-03 | 対応スタイルの調整 | - | 任意 |

### 2.4 機能3: 育毛サポート生活アドバイザー（FNC-03）

| 機能ID | 機能名 | 対象画面 | 概要 | ADKツール | 優先度 |
|--------|--------|---------|------|----------|--------|
| FNC-03-001 | 解析結果取得 | SCR-03-01 | 機能1の解析結果をFirestoreから取得 | TL-03-001 | 必須 |
| FNC-03-002 | ライトヒアリング | SCR-03-01 | 初回利用時に生活習慣を簡易ヒアリング（スキップ可） | - | 任意 |
| FNC-03-003 | 傾向スコアリング | SCR-03-01 | 遺伝性/栄養不足/ストレス/ホルモン/血行の傾向スコアを算出 | TL-03-002 | 必須 |
| FNC-03-004 | 傾向分析結果表示 | SCR-03-01 | 傾向スコアを表示 | - | 必須 |
| FNC-03-005 | 食事写真撮影 | SCR-03-02 | カメラで食事写真を撮影 | - | 必須 |
| FNC-03-006 | 食事AI栄養分析 | SCR-03-02 | 食事写真から栄養素を分析 | TL-03-003 | 必須 |
| FNC-03-007 | 栄養分析結果表示 | SCR-03-02 | 栄養分析結果を表示 | - | 必須 |
| FNC-03-008 | 食材レコメンド生成 | SCR-03-03 | 不足栄養素に基づき食材を提案 | TL-03-004 | 必須 |
| FNC-03-009 | 食材レコメンド表示 | SCR-03-03 | おすすめ食材一覧を表示 | - | 必須 |
| FNC-03-010 | 運動レコメンド生成 | SCR-03-04 | 傾向に応じた運動を提案 | TL-03-005 | 必須 |
| FNC-03-011 | 運動レコメンド表示 | SCR-03-04 | おすすめ運動一覧を表示 | - | 必須 |
| FNC-03-012 | 近くの店舗検索 | SCR-03-05 | 位置情報で近くの店舗を検索 | TL-03-006 | 任意 |
| FNC-03-013 | 店舗地図表示 | SCR-03-05 | 地図で店舗を表示 | - | 任意 |

---

## 3. 画面×機能マトリクス

### 3.1 共通画面

| 画面ID | 画面名 | FNC-00-001 | FNC-00-002 | FNC-00-003 | FNC-00-004 | FNC-00-005 | FNC-00-006 | FNC-00-007 | FNC-00-008 |
|--------|--------|------------|------------|------------|------------|------------|------------|------------|------------|
| SCR-00-01 | ログイン | ● | - | - | - | - | - | - | - |
| SCR-00-02 | プロフィール設定 | - | - | ● | ● | - | - | - | - |
| SCR-00-03 | ホーム | - | - | - | - | ● | ● | - | - |
| SCR-00-04 | 設定 | - | ● | - | - | - | - | ● | ● |

### 3.2 機能1: 生え際・髪密度 AIチェック

| 画面ID | 画面名 | 001 | 002 | 003 | 004 | 005 | 006 | 007 | 008 | 009 | 010 | 011 | 012 | 013 | 014 | 015 |
|--------|--------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| SCR-01-01 | 撮影ガイド＆撮影 | ● | ● | ● | - | - | - | - | - | - | - | - | - | - | - | - |
| SCR-01-02 | 解析結果 | - | - | - | ● | ● | ● | ● | ● | ● | ● | - | - | - | - | - |
| SCR-01-03 | ダッシュボード | - | - | - | - | - | - | - | - | - | - | ● | ● | - | - | ● |
| SCR-01-04 | レポート詳細 | - | - | - | - | - | - | - | - | - | - | - | - | ● | ● | - |

### 3.3 機能2: 髪のお悩み相談チャットボット

| 画面ID | 画面名 | 001 | 002 | 003 | 004 | 005 | 006 | 007 | 008 | 009 |
|--------|--------|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| SCR-02-01 | チャット | ● | ● | ● | ● | ● | ● | - | ● | - |
| SCR-02-02 | チーム会議モード | - | - | - | - | - | - | ● | - | - |
| SCR-02-03 | 設定 | - | - | - | - | - | - | - | - | ● |

### 3.4 機能3: 育毛サポート生活アドバイザー

| 画面ID | 画面名 | 001 | 002 | 003 | 004 | 005 | 006 | 007 | 008 | 009 | 010 | 011 | 012 | 013 |
|--------|--------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| SCR-03-01 | 傾向分析結果 | ● | ● | ● | ● | - | - | - | - | - | - | - | - | - |
| SCR-03-02 | 食事撮影＆栄養分析 | - | - | - | - | ● | ● | ● | - | - | - | - | - | - |
| SCR-03-03 | 食材レコメンド | - | - | - | - | - | - | - | ● | ● | - | - | - | - |
| SCR-03-04 | 運動レコメンド | - | - | - | - | - | - | - | - | - | ● | ● | - | - |
| SCR-03-05 | 近くの店舗 | - | - | - | - | - | - | - | - | - | - | - | ● | ● |

---

## 4. 各画面の詳細機能仕様

### 4.1 共通画面

#### SCR-00-01: ログイン

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-00-01 |
| **画面名** | ログイン |
| **概要** | Firebase AuthによるGoogleログイン画面 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 |
|--------|--------|------------------|------|------|
| FNC-00-001 | Googleログイン | 「Googleでログイン」ボタンをタップ | Googleアカウント情報 | 認証トークン |

**画面遷移**:
- 成功時 → SCR-00-02（初回）/ SCR-00-03（2回目以降）
- 失敗時 → エラーメッセージ表示

---

#### SCR-00-02: プロフィール設定

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-00-02 |
| **画面名** | プロフィール設定 |
| **概要** | 性別、年齢、悩みを設定 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 |
|--------|--------|------------------|------|------|
| FNC-00-003 | プロフィール登録 | フォーム入力後「登録」ボタン | 性別, 年齢, 悩み | Firestoreに保存 |
| FNC-00-004 | プロフィール編集 | フォーム修正後「更新」ボタン | 性別, 年齢, 悩み | Firestoreに更新 |

**入力項目**:

| 項目 | 型 | 必須 | 選択肢/制約 |
|------|-----|------|-------------|
| 性別 | enum | 必須 | male / female |
| 年齢 | number | 必須 | 10〜100 |
| 悩み | string[] | 任意 | タグ形式で複数選択可（例: 「抜け毛」「薄毛」「頭皮のかゆみ」等）、カスタム入力も可 |

**画面遷移**:
- 登録完了時 → SCR-00-03（ホーム）

---

#### SCR-00-03: ホーム

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-00-03 |
| **画面名** | ホーム |
| **概要** | 3機能への導線、最新情報サマリー |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 |
|--------|--------|------------------|------|------|
| FNC-00-005 | ホーム画面表示 | 画面表示時 | - | 最新解析結果サマリー |
| FNC-00-006 | 機能選択 | 各機能カードをタップ | - | 対象機能画面へ遷移 |

**表示項目**:
- 最新の髪密度スコア（機能1から取得）
- 最近の会話（機能2から取得）
- おすすめ食材（機能3から取得）

**画面遷移**:
- 機能1選択 → SCR-01-01
- 機能2選択 → SCR-02-01
- 機能3選択 → SCR-03-01
- 設定アイコン → SCR-00-04

---

#### SCR-00-04: 設定

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-00-04 |
| **画面名** | 設定 |
| **概要** | 通知、プライバシー、ログアウト |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 |
|--------|--------|------------------|------|------|
| FNC-00-002 | ログアウト | 「ログアウト」ボタンをタップ | - | SCR-00-01へ遷移 |
| FNC-00-007 | 通知設定 | トグルスイッチ操作 | ON/OFF | 設定保存 |
| FNC-00-008 | プライバシー設定 | 「データ削除」ボタン | - | データ削除確認 |

---

### 4.2 機能1: 生え際・髪密度 AIチェック

#### SCR-01-01: 撮影ガイド＆撮影

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-01-01 |
| **画面名** | 撮影ガイド＆撮影 |
| **概要** | AIが撮影をガイドし、頭部写真を取得 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-01-001 | 撮影ガイド表示 | 画面表示時 | 性別 | ガイドテキスト・画像 | - |
| FNC-01-002 | 頭部画像撮影 | 「撮影」ボタンをタップ | - | 画像ファイル | - |
| FNC-01-003 | 頭部画像選択 | 「ギャラリーから選択」をタップ | - | 画像ファイル | - |

**撮影ガイド（性別別）**:

| 性別 | 推奨撮影部位 | ガイドメッセージ |
|------|-------------|----------------|
| 男性 | 頭頂部、前頭部、M字生え際 | 「M字部分がわかるように撮影してください」 |
| 女性 | 分け目、頭頂部全体 | 「分け目が見えるように撮影してください」 |

**画面遷移**:
- 撮影/選択完了 → SCR-01-02（解析結果）

---

#### SCR-01-02: 解析結果

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-01-02 |
| **画面名** | 解析結果 |
| **概要** | AIによる画像解析結果を表示 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-01-004 | AI画像解析 | 撮影/選択完了後に自動実行 | 画像URL, 性別 | 解析結果 | TL-01-001 |
| FNC-01-005 | 髪密度算出 | 画像解析完了後に自動実行 | 解析結果 | 髪密度スコア(0-100) | TL-01-001 |
| FNC-01-006 | 頭皮状態判定 | 画像解析完了後に自動実行 | 解析結果 | 頭皮状態テキスト | TL-01-001 |
| FNC-01-007 | 薄毛タイプ判定（男性） | 画像解析完了後に自動実行（男性のみ） | 解析結果 | ハミルトン・ノーウッド分類（男性AGAの進行度7段階分類） | TL-01-001 |
| FNC-01-008 | 薄毛タイプ判定（女性） | 画像解析完了後に自動実行（女性のみ） | 解析結果 | ルードヴィッヒ分類（女性FAGAの進行度3段階分類） | TL-01-001 |
| FNC-01-009 | 脱毛パターン判定 | 画像解析完了後に自動実行 | 解析結果 | パターン（M字/O字等） | TL-01-001 |
| FNC-01-010 | 前回比較 | 解析完了後、履歴あり時に自動実行 | user_id, 現在の解析ID | 変化率, 比較コメント | TL-01-002 |

**表示項目**:

| 項目 | 型 | 説明 |
|------|-----|------|
| 髪密度スコア | number | 0-100のスコア |
| 頭皮状態 | string | 「良好」「やや乾燥」等 |
| 薄毛タイプ | string | 「II型vertex相当」等 |
| 脱毛パターン | string | 「O字型の傾向」等 |
| 前回比較 | string | 「+3%改善」等 |

**免責表示**: 「この判定はAIによる参考情報です。正確な診断は医療機関をご受診ください」

**エラー時の挙動**:

| エラー種別 | 表示内容 | ユーザーアクション |
|-----------|---------|------------------|
| 画像解析失敗 | 「画像を解析できませんでした。別の画像をお試しください」 | 再撮影/再選択 |
| ネットワークエラー | 「通信エラーが発生しました。再度お試しください」 | リトライボタン |
| 顔未検出 | 「頭部が検出できませんでした。撮影ガイドに従って再撮影してください」 | 再撮影 |

**画面遷移**:
- 「ダッシュボードを見る」 → SCR-01-03
- 「レポートを見る」 → SCR-01-04
- 戻るボタン → SCR-00-03

---

#### SCR-01-03: ダッシュボード

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-01-03 |
| **画面名** | ダッシュボード |
| **概要** | 時系列データの可視化 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-01-011 | 時系列データ表示 | 画面表示時 | user_id | 過去の解析履歴 | TL-01-004 |
| FNC-01-012 | 推移グラフ表示 | 画面表示時 | 時系列データ | グラフ描画 | TL-01-004 |
| FNC-01-015 | 過去写真一覧表示 | 画面表示時 | user_id | 写真サムネイル一覧 | TL-01-004 |

**表示項目**:
- 髪密度スコアの推移グラフ（折れ線グラフ）
- 過去の写真サムネイル一覧
- トレンド表示（「上昇傾向」「横ばい」等）

---

#### SCR-01-04: レポート詳細

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-01-04 |
| **画面名** | レポート詳細 |
| **概要** | AIが生成した自然言語レポート |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-01-013 | 自然言語レポート生成 | 画面表示時/更新時 | user_id, 期間 | レポートテキスト | TL-01-003 |
| FNC-01-014 | レポート詳細表示 | 画面表示時 | レポートテキスト | 画面描画 | - |

**レポート例**:
```
【今週のレポート】

前回（1/22）と比較して、髪密度が+3%改善しています。
特に頭頂部の状態が良好で、毛穴の詰まりも改善傾向にあります。

このまま現在のケアを継続してください。
次回の撮影は1週間後（2/5）を推奨します。
```

---

### 4.3 機能2: 髪のお悩み相談チャットボット

#### SCR-02-01: チャット

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-02-01 |
| **画面名** | チャット |
| **概要** | AIチャットボットとの対話 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-02-001 | チャット送信 | メッセージ入力後送信 | テキスト | - | - |
| FNC-02-002 | AI応答生成 | 自動実行 | ユーザーメッセージ | AI応答テキスト | - |
| FNC-02-003 | ユーザーニーズ分析 | 自動実行 | メッセージ | ニーズタイプ | TL-02-001 |
| FNC-02-004 | 内容適応 | 自動実行 | ニーズタイプ | 適応した応答 | - |
| FNC-02-005 | チーム会議発動（手動） | 「チーム会議」ボタン | - | SCR-02-02へ遷移 | TL-02-003 |
| FNC-02-006 | チーム会議発動（自動） | 深刻な悩み検出時に自動実行（※1） | 会話コンテキスト | SCR-02-02へ遷移 | TL-02-003 |

※1 チーム会議発動（自動）の発動条件:
- 感情分析スコアが閾値（深刻度80以上）を超えた時
- 重要な意思決定に関するキーワード検出時（例: 「治療を始めたい」「病院に行くべきか」）
- 長期間の悩み相談（連続5ターン以上同じトピック）の場合
| FNC-02-008 | 会話履歴取得 | 画面表示時 | user_id, session_id | 会話履歴 | TL-02-002 |

**内容適応パターン**:

| ニーズタイプ | AIの対応 | 例 |
|-------------|---------|-----|
| 傾聴 | 共感・受容中心 | 「そうですよね、つらいですよね」 |
| アドバイス | 具体的提案 | 「〇〇を試してみてはいかがでしょう」 |
| 科学情報 | エビデンスベース | 「研究によると〇〇が効果的です」 |
| 励まし | モチベーション支援 | 「一緒に頑張りましょう」 |

---

#### SCR-02-02: チーム会議モード

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-02-02 |
| **画面名** | チーム会議モード |
| **概要** | 3視点からの議論を表示 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-02-007 | チーム会議表示 | 画面表示時 | トピック, コンテキスト | 3視点のアドバイス | - |

**3視点**:

| 視点 | 役割 | アイコン |
|------|------|---------|
| サポーター視点 | 共感・感情面 | ハートマーク |
| コーチ視点 | 行動促進 | 旗マーク |
| ドクター視点 | 科学的根拠 | 本マーク |

---

#### SCR-02-03: 設定

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-02-03 |
| **画面名** | 設定 |
| **概要** | チャットボットの対応スタイル設定 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-02-009 | 対応スタイル設定 | スライダー操作 | スタイルレベル | 設定保存 | - |

---

### 4.4 機能3: 育毛サポート生活アドバイザー

#### SCR-03-01: 傾向分析結果

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-03-01 |
| **画面名** | 傾向分析結果 |
| **概要** | 機能1の結果と追加ヒアリングから傾向を分析 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-03-001 | 解析結果取得 | 画面表示時 | user_id | 機能1の解析結果 | TL-03-001 |
| FNC-03-002 | ライトヒアリング | 質問に回答 | 回答データ | - | - |
| FNC-03-003 | 傾向スコアリング | 自動実行 | 解析結果, 回答データ | 傾向スコア | TL-03-002 |
| FNC-03-004 | 傾向分析結果表示 | 画面表示時 | 傾向スコア | グラフ表示 | - |

**傾向スコア項目**:

| 項目 | 説明 | スコア範囲 |
|------|------|-----------|
| 遺伝性 | AGA/FAGAの傾向 | 0-100 |
| 栄養不足 | 栄養バランスの傾向 | 0-100 |
| ストレス | ストレス要因の傾向 | 0-100 |
| ホルモン（女性のみ） | ホルモンバランスの傾向 | 0-100 |
| 血行不良 | 血行状態の傾向 | 0-100 |

**免責表示**: 「この分析結果は傾向を示すものであり、医学的診断ではありません」

---

#### SCR-03-02: 食事撮影＆栄養分析

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-03-02 |
| **画面名** | 食事撮影＆栄養分析 |
| **概要** | 食事写真からAIが栄養を分析 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-03-005 | 食事写真撮影 | 「撮影」ボタンをタップ | - | 画像ファイル | - |
| FNC-03-006 | 食事AI栄養分析 | 自動実行 | 画像URL | 栄養素一覧 | TL-03-003 |
| FNC-03-007 | 栄養分析結果表示 | 画面表示時 | 栄養素一覧 | 画面描画 | - |

**栄養素表示項目**:

| 栄養素 | 髪への影響 |
|--------|-----------|
| タンパク質 | 髪の主成分（ケラチン） |
| 亜鉛 | 毛髪の成長に必須 |
| 鉄 | 毛根への酸素供給 |
| ビタミンB群 | 頭皮の健康維持 |
| ビオチン | 毛髪の強度 |

**エラー時の挙動**:

| エラー種別 | 表示内容 | ユーザーアクション |
|-----------|---------|------------------|
| 食品未検出 | 「食品を検出できませんでした。食事がはっきり写るように撮影してください」 | 再撮影 |
| 分析失敗 | 「栄養分析に失敗しました。再度お試しください」 | リトライボタン |

---

#### SCR-03-03: 食材レコメンド

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-03-03 |
| **画面名** | 食材レコメンド |
| **概要** | 傾向に基づいたおすすめ食材 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-03-008 | 食材レコメンド生成 | 画面表示時/更新時 | 傾向スコア, 性別 | 食材リスト | TL-03-004 |
| FNC-03-009 | 食材レコメンド表示 | 画面表示時 | 食材リスト | 画面描画 | - |

**レコメンド例（男性・O字型傾向）**:

| 食材 | 理由 | 含まれる栄養素 |
|------|------|---------------|
| 牡蠣 | 亜鉛が豊富 | 亜鉛 |
| 納豆 | DHT抑制に寄与 | イソフラボン |
| 青魚 | 血行促進 | オメガ3 |

---

#### SCR-03-04: 運動レコメンド

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-03-04 |
| **画面名** | 運動レコメンド |
| **概要** | 傾向に基づいたおすすめ運動 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-03-010 | 運動レコメンド生成 | 画面表示時/更新時 | 傾向スコア, 性別 | 運動リスト | TL-03-005 |
| FNC-03-011 | 運動レコメンド表示 | 画面表示時 | 運動リスト | 画面描画 | - |

---

#### SCR-03-05: 近くの店舗

| 項目 | 内容 |
|------|------|
| **画面ID** | SCR-03-05 |
| **画面名** | 近くの店舗 |
| **概要** | おすすめ食材が買える近くの店舗を地図表示 |

**機能一覧**:

| 機能ID | 機能名 | ユーザーアクション | 入力 | 出力 | ADKツール |
|--------|--------|------------------|------|------|----------|
| FNC-03-012 | 近くの店舗検索 | 画面表示時/位置情報取得後 | 位置情報, 食材リスト | 店舗リスト | TL-03-006 |
| FNC-03-013 | 店舗地図表示 | 画面表示時 | 店舗リスト | 地図描画 | - |

---

## 5. ADKツール仕様

### 5.1 TL-01: haircheck_agent

#### TL-01-001: analyze_hair_image

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-01-001 |
| **ツール名** | analyze_hair_image |
| **所属エージェント** | haircheck_agent |
| **用途** | Gemini Visionで頭部画像を解析し、髪密度・頭皮状態・タイプを判定 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| image_url | string | 必須 | 解析対象画像のURL |
| gender | string | 必須 | "male" または "female" |

**出力（成功時）**:

```python
# 男性の場合
{
    "status": "success",
    "hair_density": 72,           # 0-100のスコア
    "scalp_condition": "やや乾燥",
    "fine_hair_ratio": 0.15,      # 細毛率
    "hamilton_norwood": "II型vertex",  # 男性のみ
    "pattern_male": "O字"              # 男性のみ（M字/O字/U字）
}

# 女性の場合
{
    "status": "success",
    "hair_density": 72,
    "scalp_condition": "やや乾燥",
    "fine_hair_ratio": 0.15,
    "ludwig": "I型",                   # 女性のみ（I型/II型/III型）
    "pattern_female": "びまん性"       # 女性のみ（びまん性/オルセン型/ハミルトン型）
}
```

**出力（エラー時）**:

```python
{
    "status": "error",
    "error_code": "INVALID_IMAGE",    # INVALID_IMAGE / FACE_NOT_DETECTED / PROCESSING_FAILED
    "error_message": "解析可能な頭部画像を検出できませんでした"
}
```

---

#### TL-01-002: compare_with_history

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-01-002 |
| **ツール名** | compare_with_history |
| **所属エージェント** | haircheck_agent |
| **用途** | 過去の解析結果と比較し、変化を検出 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| user_id | string | 必須 | ユーザーID |
| current_analysis_id | string | 必須 | 現在の解析ID |

**出力**:

```python
# 成功時
{
    "status": "success",
    "change_rate": 3.2,           # 変化率(%)
    "trend": "improving",         # improving / stable / declining
    "comparison_text": "前回と比べて髪密度が+3%改善しています"
}

# エラー時
{
    "status": "error",
    "error_code": "NO_HISTORY",   # NO_HISTORY / ANALYSIS_NOT_FOUND
    "error_message": "比較可能な過去データがありません"
}
```

---

#### TL-01-003: generate_report

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-01-003 |
| **ツール名** | generate_report |
| **所属エージェント** | haircheck_agent |
| **用途** | 時系列データから自然言語レポートを生成 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| user_id | string | 必須 | ユーザーID |
| period | string | 任意 | "weekly" / "monthly"（デフォルト: weekly） |

**出力**:

```python
{
    "status": "success",
    "report_text": "【今週のレポート】\n\n前回（1/22）と比較して..."
}
```

---

#### TL-01-004: get_user_photos

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-01-004 |
| **ツール名** | get_user_photos |
| **所属エージェント** | haircheck_agent |
| **用途** | 過去の写真と解析結果一覧を取得 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| user_id | string | 必須 | ユーザーID |

**出力**:

```python
{
    "status": "success",
    "photos": [
        {
            "analysis_id": "xxx",
            "photo_url": "https://...",
            "uploaded_at": "2026-01-22T10:00:00Z",
            "hair_density": 69
        },
        ...
    ]
}
```

---

### 5.2 TL-02: consultation_agent

#### TL-02-001: analyze_user_need

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-02-001 |
| **ツール名** | analyze_user_need |
| **所属エージェント** | consultation_agent |
| **用途** | ユーザーのメッセージから求めている対応を分析 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| message | string | 必須 | ユーザーのメッセージ |

**出力**:

```python
# 成功時
{
    "status": "success",
    "need_type": "listening",     # listening / advice / science / encouragement
    "confidence": 0.85
}

# エラー時
{
    "status": "error",
    "error_code": "EMPTY_MESSAGE",
    "error_message": "メッセージが空です"
}
```

---

#### TL-02-002: get_conversation_context

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-02-002 |
| **ツール名** | get_conversation_context |
| **所属エージェント** | consultation_agent |
| **用途** | 過去の会話履歴を取得 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| user_id | string | 必須 | ユーザーID |
| session_id | string | 任意 | セッションID（省略時は最新） |

**出力**:

```python
{
    "status": "success",
    "messages": [
        {"role": "user", "content": "最近抜け毛が増えて..."},
        {"role": "assistant", "content": "それは心配ですよね..."},
        ...
    ]
}
```

---

#### TL-02-003: trigger_team_meeting

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-02-003 |
| **ツール名** | trigger_team_meeting |
| **所属エージェント** | consultation_agent |
| **用途** | 3視点からのアドバイスを生成 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| topic | string | 必須 | 議論のトピック |
| context | string | 必須 | 会話のコンテキスト |

**出力**:

```python
{
    "status": "success",
    "supporter": "まずは気持ちを大切にしましょう...",
    "coach": "具体的に〇〇から始めてみては...",
    "doctor": "研究によると〇〇が効果的です..."
}
```

---

### 5.3 TL-03: lifestyle_agent

#### TL-03-001: get_hair_analysis

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-001 |
| **ツール名** | get_hair_analysis |
| **所属エージェント** | lifestyle_agent |
| **用途** | 機能1の解析結果をFirestoreから取得 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| user_id | string | 必須 | ユーザーID |

**出力**:

```python
{
    "status": "success",
    "latest_analysis": {
        "hair_density": 72,
        "hamilton_norwood": "II型vertex",  # または ludwig
        "pattern": "O字",
        "uploaded_at": "2026-01-29T10:00:00Z"
    }
}
```

---

#### TL-03-002: analyze_tendency

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-002 |
| **ツール名** | analyze_tendency |
| **所属エージェント** | lifestyle_agent |
| **用途** | 画像解析結果とヒアリング回答から傾向スコアを算出 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| analysis_data | dict | 必須 | 機能1の解析結果 |
| questionnaire | dict | 任意 | ライトヒアリングの回答（下記スキーマ） |

**questionnaire スキーマ**:

```python
questionnaire = {
    "family_history": bool,       # 家族に薄毛の人がいるか
    "stress_level": int,          # 1-5（1=低、5=高）
    "sleep_hours": float,         # 平均睡眠時間
    "exercise_frequency": int,    # 週の運動回数
    "diet_balance": int,          # 1-5（食事バランス）
    "smoking": bool,              # 喫煙習慣
    "alcohol_frequency": int      # 週の飲酒回数
}
```

**出力（成功時）**:

```python
{
    "status": "success",
    "tendency_scores": {
        "genetic": 65,
        "nutrition": 40,
        "stress": 55,
        "hormonal": 30,        # 女性のみ
        "blood_circulation": 45
    }
}
```

**出力（エラー時）**:

```python
{
    "status": "error",
    "error_code": "INVALID_DATA",
    "error_message": "解析データが不正です"
}
```

---

#### TL-03-003: analyze_meal_photo

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-003 |
| **ツール名** | analyze_meal_photo |
| **所属エージェント** | lifestyle_agent |
| **用途** | 食事写真から栄養素を分析 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| image_url | string | 必須 | 食事画像のURL |

**出力**:

```python
{
    "status": "success",
    "detected_foods": ["焼き鮭", "ご飯", "味噌汁"],
    "nutrients": {
        "protein": "high",
        "zinc": "medium",
        "iron": "low",
        "vitamin_b": "medium",
        "biotin": "low"
    }
}
```

---

#### TL-03-004: recommend_foods

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-004 |
| **ツール名** | recommend_foods |
| **所属エージェント** | lifestyle_agent |
| **用途** | 傾向スコアに基づいて食材を提案 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| tendency_scores | dict | 必須 | 傾向スコア |
| gender | string | 必須 | "male" または "female" |

**出力**:

```python
{
    "status": "success",
    "recommendations": [
        {
            "food": "牡蠣",
            "reason": "亜鉛が豊富で毛髪の成長を促進",
            "nutrients": ["亜鉛"]
        },
        ...
    ]
}
```

---

#### TL-03-005: recommend_exercises

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-005 |
| **ツール名** | recommend_exercises |
| **所属エージェント** | lifestyle_agent |
| **用途** | 傾向スコアに基づいて運動を提案 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| tendency_scores | dict | 必須 | 傾向スコア |
| gender | string | 必須 | "male" または "female" |

**出力**:

```python
{
    "status": "success",
    "recommendations": [
        {
            "exercise": "頭皮マッサージ",
            "reason": "血行促進により毛根への栄養供給を改善",
            "duration": "5分/日"
        },
        ...
    ]
}
```

---

#### TL-03-006: search_nearby_stores

| 項目 | 内容 |
|------|------|
| **ツールID** | TL-03-006 |
| **ツール名** | search_nearby_stores |
| **所属エージェント** | lifestyle_agent |
| **用途** | 位置情報を基に近くの店舗を検索 |

**入力パラメータ**:

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| location | dict | 必須 | {"lat": float, "lng": float} |
| food_items | list[str] | 必須 | 検索する食材リスト（例: ["牡蠣", "納豆", "青魚"]） |

**出力（成功時）**:

```python
{
    "status": "success",
    "stores": [
        {
            "name": "〇〇スーパー",
            "address": "東京都...",
            "distance": "300m",
            "lat": 35.xxx,
            "lng": 139.xxx
        },
        ...
    ]
}
```

**出力（エラー時）**:

```python
{
    "status": "error",
    "error_code": "LOCATION_ERROR",  # LOCATION_ERROR / NO_STORES_FOUND
    "error_message": "位置情報を取得できませんでした"
}
```

---

## 6. データ連携図

```
┌─────────────────────────────────────────────────────────────────┐
│                         Firestore                                │
│                                                                  │
│  users/{userId}/                                                 │
│    ├── profile/          ←── SCR-00-02 (プロフィール設定)        │
│    │                                                             │
│    ├── hairAnalysis/     ←── SCR-01-02 (解析結果)                │
│    │   └── {analysisId}/ ←── TL-01-001 (analyze_hair_image)      │
│    │                     ──→ TL-03-001 (get_hair_analysis)       │
│    │                     ──→ TL-01-002 (compare_with_history)    │
│    │                     ──→ TL-01-004 (get_user_photos)         │
│    │                                                             │
│    ├── conversations/    ←── SCR-02-01 (チャット)                │
│    │   └── {sessionId}/  ←── TL-02-002 (get_conversation_context)│
│    │                                                             │
│    └── lifestyle/        ←── SCR-03-01 (傾向分析結果)            │
│        ├── tendencyScores/ ←── TL-03-002 (analyze_tendency)      │
│        ├── questionnaire/                                        │
│        └── mealPhotos/   ←── TL-03-003 (analyze_meal_photo)      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

機能間データ連携:

┌────────────┐         ┌────────────┐         ┌────────────┐
│  機能1:     │         │  機能2:     │         │  機能3:     │
│  AIチェック │         │チャットボット│         │アドバイザー │
└─────┬──────┘         └────────────┘         └──────┬─────┘
      │                                               │
      │  hairAnalysis/{analysisId}                    │
      └───────────────────────────────────────────────┘
                    Firestore経由で連携
```

---

## 7. 付録

### 7.1 参照ドキュメント

- [DESIGN_v3.md](../../../DESIGN_v3.md) - 設計書本体
- [プランファイル](../../../../.claude/plans/squishy-tinkering-knuth.md) - 詳細設計プラン

### 7.2 用語集

| 用語 | 説明 |
|------|------|
| ハミルトン・ノーウッド分類 | 男性AGAの進行パターンを7段階で分類する世界標準 |
| ルードヴィッヒ分類 | 女性FAGAの進行パターンを3段階で分類する方法 |
| ADK | Google Agent Development Kit |
| Firestore | Google Cloudのドキュメントデータベース |

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-01-29 | 1.0 | 初版作成 |
| 2026-01-29 | 1.1 | レビュー結果に基づく修正: FNC-01-005a（細毛率算出）追加、ADKツールのエラーレスポンス定義追加、自動実行トリガー条件明確化、チーム会議自動発動条件具体化、questionnaire スキーマ追加、用語表記統一（ルードウィック→びまん性）、エラー時挙動セクション追加 |
